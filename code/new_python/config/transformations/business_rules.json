{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "description": "Business rules and filters for AZ and AZEC data processing",
  "coassurance_config": {
    "description": "Coassurance calculation rules - SAS PTF_MVTS_AZ_MACRO.sas L63-77",
    "top_coass": {
      "description": "Flag to indicate if contract is in coassurance",
      "conditions": [
        {
          "col": "cdpolqpl",
          "op": "==",
          "value": "1",
          "result": 1
        }
      ],
      "default": 0
    },
    "coass": {
      "description": "Coassurance type categorization",
      "conditions": [
        {
          "col": "cdpolqpl",
          "op": "==",
          "value": "1",
          "and_col": "cdcoas",
          "and_in": [
            "3",
            "6"
          ],
          "result": "APERITION"
        },
        {
          "col": "cdpolqpl",
          "op": "==",
          "value": "1",
          "and_col": "cdcoas",
          "and_in": [
            "4",
            "5"
          ],
          "result": "COASS. ACCEPTEE"
        },
        {
          "col": "cdpolqpl",
          "op": "==",
          "value": "1",
          "and_col": "cdcoas",
          "and_in": [
            "8"
          ],
          "result": "ACCEPTATION INTERNATIONALE"
        },
        {
          "col": "cdpolqpl",
          "op": "==",
          "value": "1",
          "and_col": "cdcoas",
          "and_not_in": [
            "3",
            "4",
            "5",
            "6",
            "8"
          ],
          "result": "AUTRES"
        }
      ],
      "default": "SANS COASSURANCE"
    },
    "partcie": {
      "description": "Company participation percentage calculation",
      "conditions": [
        {
          "col": "cdpolqpl",
          "op": "!=",
          "value": "1",
          "result": 1.0
        },
        {
          "col": "cdpolqpl",
          "op": "==",
          "value": "1",
          "result_expr": "prcdcie / 100.0"
        }
      ],
      "default": 1.0
    },
    "top_revisable": {
      "description": "Flag to indicate if contract has revision clause",
      "conditions": [
        {
          "col": "cdpolrvi",
          "op": "==",
          "value": "1",
          "result": 1
        }
      ],
      "default": 0
    }
  },
  "business_filters": {
    "description": "Business filters to apply on AZ and AZEC data",
    "az": {
      "description": "AZ (Agent + Courtage) business filters - SAS PTF_MVTS_AZ_MACRO.sas L40-48",
      "filters": [
        {
          "type": "not_equals",
          "column": "cdri",
          "value": "X",
          "description": "Exclude risk indicator X"
        },
        {
          "type": "not_in",
          "column": "cdsitp",
          "values": [
            "4",
            "5"
          ],
          "description": "Exclude policy status 4 and 5"
        },
        {
          "type": "not_in",
          "column": "noint",
          "value": [
            "H90061",
            "482001",
            "489090",
            "102030",
            "H90036",
            "H90059",
            "H99045",
            "H99059",
            "5B2000",
            "446000",
            "5R0001",
            "446118",
            "4F1004",
            "4A1400",
            "4A1500",
            "4A1600",
            "4A1700",
            "4A1800",
            "4A1900",
            "4L1010"
          ],
          "description": "Exclude specific intermediaries"
        },
        {
          "type": "not_equals",
          "column": "cdprod",
          "value": "01073",
          "description": "Exclude product 01073"
        },
        {
          "type": "in",
          "column": "cdnatp",
          "values": [
            "R",
            "O",
            "T",
            "C"
          ],
          "description": "Valid policy natures only"
        },
        {
          "type": "equals",
          "column": "cmarch",
          "value": "6",
          "description": "Construction market only"
        },
        {
          "type": "equals",
          "column": "csegt",
          "value": "2",
          "description": "Construction segment only"
        }
      ]
    },
    "azec": {
      "description": "AZEC business filters - from SAS PTF_MVTS_AZEC_MACRO.sas L81-85",
      "excluded_intermediaries": [
        "24050",
        "40490"
      ],
      "excluded_policies": [
        "012684940"
      ],
      "filters": [
        {
          "type": "not_in",
          "column": "intermed",
          "values_ref": "excluded_intermediaries",
          "description": "Exclude fictitious intermediaries"
        },
        {
          "type": "not_in",
          "column": "police",
          "values_ref": "excluded_policies",
          "description": "Exclude fictitious policies"
        },
        {
          "type": "complex",
          "expression": "~((duree == '00') & ~produit.isin(['DO0', 'TRC', 'CTR', 'CNR']))",
          "description": "Exclude temporaries except specific products"
        },
        {
          "type": "not_equals_column",
          "column": "datfin",
          "compare_column": "effetpol",
          "description": "Exclude contracts without effect"
        },
        {
          "type": "complex",
          "expression": "(gestsit != 'MIGRAZ') | ((gestsit == 'MIGRAZ') & (etatpol == 'R'))",
          "description": "Gestsit migration logic"
        }
      ]
    }
  },
  "lta_types": {
    "description": "Long term agreement risk types - SAS L242-243",
    "types": [
      "QAW",
      "QBJ",
      "QBK",
      "QBB",
      "QBM"
    ]
  }
}